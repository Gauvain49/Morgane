{% extends 'admin/base.html.twig' %}

{% block title %}Coûts d'expédition{% endblock %}
{% form_theme form _self %}
{% block stylesheets %}
<style type="text/css">
	fieldset {
		padding: 0 !important;
	}
	.listCountry legend {
		display: none;
	}
	.listCountry .col-4 {
		border-right: solid 1px #e2e2e2;
	}
</style>
{% endblock %}
{% block body %}
<div class="page-header">
    <h4 class="page-title">Coûts d'expédition</h4>
    <ul class="breadcrumbs">
        <li class="nav-home">
            <a href="{{ path('dashboard') }}">
                <i class="flaticon-home"></i>
            </a>
        </li>
        <li class="separator">
            <i class="flaticon-right-arrow"></i>
        </li>
        <li class="nav-item">
            E-commerce
        </li>
        <li class="separator">
            <i class="flaticon-right-arrow"></i>
        </li>
        <li class="nav-item">
            <a href="{{ path('carriers_index') }}"></a>Livraison
        </li>
        <li class="separator">
            <i class="flaticon-right-arrow"></i>
        </li>
        <li class="nav-item">
            Ajouter un transporteur
        </li>
    </ul>
</div>
<div class="row">
	<div class="col-md-2">
		<div class="card">
			<aside>
				<div class="list-group">
					<a href="{{ path('carriers_edit', {'id': id}) }}" class="list-group-item">Transporteur</a>
					<a href="{{ path('carriers_config_edit', {'id': id}) }}" class="list-group-item active">Coûts d'expédition</a>
				</div>
			</aside>
		</div>
	</div>
	<div class="col-md-10">
		<div class="card">
			<div class="card-header">
				<div class="card-head-row">
					<h4 class="card-title text-info">Coût d'expédition</h4>
					<div class="card-tools">
						<a href="{{ path('carriers_new') }}" class="btn btn-info font-weight-bold"><span class="btn-label"><i class="flaticon-plus"></i></span> Ajouter un transporteur</a>
					</div>
				</div>
			</div>
			<div class="card-body">
				{{ include('admin/carriers/config/_form.html.twig', {'button_label': 'Enregistrer'}) }}
			</div>
		</div>
	</div>
</div>
    {# include('admin/carriers/config/_delete_form.html.twig') #}
{% endblock %}
{# block _carriers_config_steps_widget %}
	{{ form_widget(form) }}
{% endblock #}
{# block _carriers_config_steps_entry_row %}
	{{ form_widget(form) }}
{% endblock #}
{# block _carriers_config_steps_entry_row %}
<div class="col-4">
	<div class="form-group">
		<div class="row">
			{{ form_label(form.step_min) }}
			<div class="col-sm-6 input-group">
				<div class="input-group-prepend">
		        	<div class="input-group-text">€</div>
		        </div>
				{{ form_widget(form.step_min) }}
			</div>
		</div>
	</div>
	<div class="form-group">
		<div class="row">
			{{ form_label(form.step_max) }}
			<div class="col-sm-6 input-group">
				<div class="input-group-prepend">
		        	<div class="input-group-text">€</div>
		        </div>
				{{ form_widget(form.step_max) }}
			</div>
		</div>
	</div>
	<div class="form-group" style="padding: 0;">
		{{ form_widget(form.amountCountries) }}
	</div>
</div>
{% endblock #}
{# block carriers_config_amountCountries_entry_widget %}
	<div class="form-group row">
		{{ form_label(form.country_amount) }}
		<div class="col-sm-6 input-group">
			<div class="input-group-prepend">
	        	<div class="input-group-text">€</div>
	        </div>
			{{ form_widget(form.country_amount) }}
			{{ form_widget(form.step_country) }}
		</div>
	</div>
{% endblock #}
{# block _carriers_config_steps_step_min_entry_row %}
	<div class="form-group">
		<div class="row">
			{{ form_label(form.step_min) }}
			<div class="col-sm-6 input-group">
				{{ form_widget(form.step_min) }}
			</div>
		</div>
	</div>
{% endblock #}
{% block javascripts %}
	<script src="{{ asset('admin/js/country_carriers.js') }}"></script>
	<script type="text/javascript">
		//document.getElementById('widgets-counter').value = countStep;
		/*var index = +$('#widgets-counter').val();
		//if (index > 0) {
			//index + 1;
		//} 
		//console.log(index);
		const tmpl = $('#carriers_config_steps').data('prototype').replace(/__name__/g, index);

		//J'injecte ce code au sein des entrées
		$('#carriers_config_steps').append(tmpl);
		$('#widgets-counter').val(index + 1);*/
		var noeud = document.getElementById('carriers_config_steps');
		//On récupère le contenu des divs à créer
		var contents = noeud.getAttribute('data-prototype');
		var counter = 0;//On implémente le compteur
		for(var i = 0; i <= {{ countStep }}; i++) {
			var ifExist = document.getElementById('carriers_config_steps' + '_' + counter);
			console.log(ifExist);
			if (ifExist === null) {
				var content = contents.replace(/__name__/g, counter);
				noeud.insertAdjacentHTML('beforeend', content);
			}
			counter++;
			console.log(i);
		}

		//Création du tableau recueillant les pays
		const listCountry = new Object();
		{% for country in countries %}
			{% for countryLang in country.countriesLangs %}
				{% if countryLang.lang.id == languagesService.languageDefault.id %}
					listCountry[{{country.id}}] = '{{countryLang.countryName}}';
				{% endif %}
			{% endfor %}
		{% endfor %}

		//Function pour calculer la taille du tableau
		Object.size = function(arr) 
		{
		    var size = 0;
		    for (var key in arr) 
		    {
		        if (arr.hasOwnProperty(key)) size++;
		    }
		    return size;
		};
		var langLength = Object.size(listCountry);

		{% for i in 0..countStep %}
		countryCarriers('carriers_config_steps_{{ i }}_amountCountries', listCountry, {{ languagesService.getLanguages|length }});
		{% endfor %}

			</script>
{% endblock %}