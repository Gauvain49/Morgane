{% extends 'base.html.twig' %}

{% block title %}Notre catalogue{% endblock %}
{% block main %}
<div class="homePage">
	<section class="homePage homeNewsItem clearfix">
		<header>
			<div class="arianeCat">
				<ul>
					{% for ariane in filAriane %}
					<a href="{{ path('catalog', {'slug': ariane.slug}) }}" style="text-decoration: none;"><li>&nbsp;&nbsp;⟩&nbsp;&nbsp;{{ ariane.name }}</li></a>
					{% endfor %}
				</ul>
			</div>
		</header>
		<aside class="filtreCat">
			<header>
				<p>Filtrer les produits</p>
			</header>
			<ul>
				{% if categoriesChildren|length > 0 %}
				{% for categorie in categoriesChildren %}
					{% for lala in categorie.contents %}

					{% endfor %}
				<li>
				{% for content in categorie.contents %}
				{% if content.lang.id == languagesService.languageDefault.id %}
					<a href="{{ path('catalog', {'slug': content.slug }) }}">{{ content.name }}</a>
				{% endif %}
				{% endfor %}
				</li>
				{% endfor %}
				{% else %}
				<li style="color: #fff;">Plus de filtrage possible</li>
				{% endif %}
			</ul>
		</aside>
		<div id="afficheProduitCategorie" style="margin-left: 230px;">
			{% for product in products %}
			{% if product.type == 'master' %}
				{% set slug = '' %}
				{% for content in product.contents %}
					{% if content.lang.id == 1 %}
						{% set slug = content.slug %}
					{% endif %}
				{% endfor %}
			<article class="vignetteProduit">
				<div>
					{% if product.supplier != null %}
					<h2>
						{% for supplier in suppliers %}
						{% if supplier.id == product.supplier.id %}
							{{ supplier.supplierName }}
						{% endif %}
						{% endfor %}
					</h2>
					{% endif %}
					<p class="imgProduit">
						<a href="{{ path('product_detail', {'slug': slug}) }}">
							{% if product.id in imgPath|keys %}
							<img src="{{ asset('img/p/') ~ imgPath[product.id] }}" alt="{% for content in product.contents %}{% if content.lang.id == 1 %}{{ content.name }}{% endif %}{% endfor %}">
							{% else %}
							<img src="{{ asset('img/p/fr.jpg') }}" alt="{% for content in product.contents %}{% if content.lang.id == 1 %}{{ content.name }}{% endif %}{% endfor %}">
							{% endif %}
						</a>
					</p>
					<div class="des">
						<p class="titreProduit"><a href="{{ path('product_detail', {'slug': slug}) }}">{% for content in product.contents %}{% if content.lang.id == 1 %}{{ content.name }}{% endif %}{% endfor %}</a></p>
						<div class="desShort">
							{% for content in product.contents %}{% if content.lang.id == 1 %}{{ content.summary|raw }}{% endif %}{% endfor %}
						</div>
						<div class="tarifProduit">
							{% if product.sellingPriceAllTaxes > 0 %}
							{% if product.discount != '' %}
								{% set netprice = product.discount|discountPriceAT(product.discountType, product.discountOnTaxe, '20', product.sellingPrice, product.sellingPriceAllTaxes) %}
							<div class="zonePromo">
							<p class="pourcentPromo">{{ (netprice - product.sellingPriceAllTaxes)|number_format(2, ',', ' ') }} €</p>
							<p class="prixBarre">{{ product.sellingPriceAllTaxes|number_format(2, ',', ' ') }} €</p>
							</div>
							<p class="prix">Prix Spot'light : {{ netprice|number_format(2, ',', ' ') }} €</p>
							{% else %}
							<p class="prix">Prix Spot'light : {{ product.sellingPriceAllTaxes|number_format(2, ',', ' ') }} €</p>
							{% endif %}
							{% endif %}
						{% if product.propertiesContents|length > 0 %}
							{% for property in product.propertiesContents %}
								{% if property.lang.id == languagesService.languageDefault.id %}
								{% for propertie in properties %}
									{% if property.property.id == propertie.id %}
										<p class="prix" style="background-color: #009F49;">{% for content in propertie.properties %}{{ content.name }}{% endfor %} : {{ property.value|number_format(2, ',', ' ') }} €</p>
									{% endif %}
								{% endfor %}
								{% endif %}
							{% endfor %}
						{% endif %}

						</div>
					</div>
				</div>
			</article>
				{% endif %}
			{% endfor %}
		</div>
	<div id="pagination" style="clear: both;">
		<ul class="pagination justify-content-center">
				{% if page == 1 %}
					<li class="disabled">< Précédent</li>
				{% else %}
				<li class="page-item">
					{% if slugCat == false %}
					<a class="page-link" href="{{ path('catalog-by-cat', {'cat': getCat, 'page': page - 1}) }}">
						<i class="zmdi zmdi-chevron-left">< Précédent</i>
					</a>
					{% else %}
					<a class="page-link" href="{{ path('catalog', {'slug': slugCat, 'page': page - 1})}}">
						<i class="zmdi zmdi-chevron-left">< Précédent</i>
					</a>
					{% endif %}
				</li>
				{% endif %}
				{% for i in 1..pages %}
				<li class="page-item{% if page == i %} active{% endif %}">
					{% if slugCat == false %}
					<a class="page-link" href="{{ path('catalog-by-cat', {'cat': getCat, 'page': i}) }}">
						{{ i }}
					</a>
					{% else %}
					<a class="page-link" href="{{ path('catalog', {'slug': slugCat, 'page': i})}}">{{ i }}</a>
					{% endif %}
				</li>
				{% endfor %}
				{% if page == pages %}
					<li class="disabled">> Suivant</li>
				{% else %}
				<li class="page-item {% if page == pages %}disabled{% endif %}">
					{% if slugCat == false %}
					<a class="page-link" href="{{ path('catalog-by-cat', {'cat': getCat, 'page': page + 1}) }}">
						<i class="zmdi zmdi-chevron-right">> Suivant</i>
					</a>
					{% else %}
					<a class="page-link" href="{{ path('catalog', {'slug': slugCat, 'page': page + 1})}}">
						<i class="zmdi zmdi-chevron-right">> Suivant</i>
					</a>
					{% endif %}
				</li>
				{% endif %}
			</ul>
	</div>
	</section>
</div>
{% endblock %}